<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="apelido">
        <p>Apelido:</p> 
        <input type="text" id="apelido" size="15">
    </div>
    <br><br>
    <div id="resposta"></div>
    <br><br>
    <div class="enviar">
        <p>Mensagem:</p> <input type="text" id="texto" size="50">
        <button onclick="Enviar();" id="enviar">Enviar</button>
        <button onclick="Enviar10();" id="enviar10">Enviar 10</button>
        <button onclick="emote1();" id="emote1">emote1</button>
        <button onclick="emote2();" id="emote2">emote2</button>
        <button onclick="emote3();" id="emote3">emote3</button>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js"> </script>

    <script>
    
        topico= "Chat_PizzaDeBrocolis"
        client = new Paho.MQTT.Client("broker.hivemq.com", Number(8000),"")
        client.connect( {onSuccess:Conectou} )
    
        function Conectou() {
            client.subscribe(topico)
            message = new Paho.MQTT.Message('')
            message.destinationName = topico
        }
    
        client.onConnectionLost = Conexao_Perdida
        client.onMessageArrived = Mensagem_Chegou
    
        function Conexao_Perdida(responseObject){
            if (responseObject.errorCode !==0) {
                resposta.innerHTML += "Desconectado: " + responseObject.errorMenssage
            }
        }
    
        function Mensagem_Chegou(message){
            resposta.innerHTML += "<br>"
            resposta.innerHTML += message.payloadString
        }

        function Enviar(){
            valor ='<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRk5RgoUUCiE2T3FTuxxGTGulotSkE86Sp9qw&usqp=CAU" class="apelidoimg" width="25px" height="25px"> <style>.apelidoimg{border-radius: 35px;}</style>' +  apelido.value + ": " + texto.value
            message = new Paho.MQTT.Message(valor)
            message.destinationName = topico
            client.send(message)
        }
        function Enviar10(){
            var a = 1
            while (a <= 10){
            valor = '<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRk5RgoUUCiE2T3FTuxxGTGulotSkE86Sp9qw&usqp=CAU" class="apelidoimg" width="25px" height="25px"> <style>.apelidoimg{border-radius: 35px;}</style>' + apelido.value + ": " + texto.value
            message = new Paho.MQTT.Message(valor)
            message.destinationName = topico
            client.send(message)
            a++
            }
        }
        function emote1(){
            valor = '<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRk5RgoUUCiE2T3FTuxxGTGulotSkE86Sp9qw&usqp=CAU" class="apelidoimg" width="25px" height="25px"> <style>.apelidoimg{border-radius: 35px;}</style>' + apelido.value + ": " + '<img src="https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Gragas_4.jpg" width="150px">'
            message = new Paho.MQTT.Message(valor)
            message.destinationName = topico
            client.send(message)

        }
        function emote2(){
            valor = '<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRk5RgoUUCiE2T3FTuxxGTGulotSkE86Sp9qw&usqp=CAU" class="apelidoimg" width="25px" height="25px"> <style>.apelidoimg{border-radius: 35px;}</style>' + apelido.value + ": " + '<iframe src="https://giphy.com/embed/Dg4TxjYikCpiGd7tYs" width="150px" ></iframe>'
            message = new Paho.MQTT.Message(valor)
            message.destinationName = topico
            client.send(message)
        }
        function emote3(){
            valor = '<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRk5RgoUUCiE2T3FTuxxGTGulotSkE86Sp9qw&usqp=CAU" class="apelidoimg" width="25px" height="25px"> <style>.apelidoimg{border-radius: 35px;}</style>' + apelido.value + ": " + '<img src="https://ae01.alicdn.com/kf/S9bb91d79437a4520aa8a2bb92bf686ade/Rammus-masculino-emote-ok-liga-das-lendas-t-camisa-liga-das-lendas-lol-puro-algod-o.jpg" width="150px">'
            message = new Paho.MQTT.Message(valor)
            message.destinationName = topico
            client.send(message)
        }

</script>
</html>